---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.12.0
  name: teststeps.chainsaw.kyverno.io
spec:
  group: chainsaw.kyverno.io
  names:
    kind: TestStep
    listKind: TestStepList
    plural: teststeps
    singular: teststep
  scope: Cluster
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: TestStep is the resource that contains the testStep used to run
          tests.
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: TestStep spec.
            properties:
              catch:
                description: Catch defines what the step will execute when an error
                  happens.
                items:
                  description: Catch defines actions to be executed on failure.
                  properties:
                    command:
                      description: Command defines a command to run.
                      properties:
                        args:
                          description: Args is the command arguments.
                          items:
                            type: string
                          type: array
                        check:
                          description: Check is an assertion tree to validate the
                            operation outcome.
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        entrypoint:
                          description: Entrypoint is the command entry point to run.
                          type: string
                        skipLogOutput:
                          description: SkipLogOutput removes the output from the command.
                            Useful for sensitive logs or to reduce noise.
                          type: boolean
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      required:
                      - entrypoint
                      type: object
                    description:
                      description: Description contains a description of the operation.
                      type: string
                    events:
                      description: Events determines the events collector to execute.
                      properties:
                        name:
                          description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                          type: string
                        namespace:
                          description: 'Namespace of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/'
                          type: string
                        selector:
                          description: Selector defines labels selector.
                          type: string
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    podLogs:
                      description: PodLogs determines the pod logs collector to execute.
                      properties:
                        container:
                          description: Container in pod to get logs from else --all-containers
                            is used.
                          type: string
                        name:
                          description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                          type: string
                        namespace:
                          description: 'Namespace of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/'
                          type: string
                        selector:
                          description: Selector defines labels selector.
                          type: string
                        tail:
                          description: Tail is the number of last lines to collect
                            from pods. If omitted or zero, then the default is 10
                            if you use a selector, or -1 (all) if you use a pod name.
                            This matches default behavior of `kubectl logs`.
                          type: integer
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    script:
                      description: Script defines a script to run.
                      properties:
                        check:
                          description: Check is an assertion tree to validate the
                            operation outcome.
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        content:
                          description: Content defines a shell script (run with "sh
                            -c ...").
                          type: string
                        skipLogOutput:
                          description: SkipLogOutput removes the output from the command.
                            Useful for sensitive logs or to reduce noise.
                          type: boolean
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    sleep:
                      description: Sleep defines zzzz.
                      properties:
                        duration:
                          description: Duration is the delay used for sleeping.
                          type: string
                      required:
                      - duration
                      type: object
                  type: object
                type: array
              description:
                description: Description contains a description of the test step.
                type: string
              finally:
                description: Finally defines what the step will execute after the
                  step is terminated.
                items:
                  description: Finally defines actions to be executed at the end of
                    a test.
                  properties:
                    command:
                      description: Command defines a command to run.
                      properties:
                        args:
                          description: Args is the command arguments.
                          items:
                            type: string
                          type: array
                        check:
                          description: Check is an assertion tree to validate the
                            operation outcome.
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        entrypoint:
                          description: Entrypoint is the command entry point to run.
                          type: string
                        skipLogOutput:
                          description: SkipLogOutput removes the output from the command.
                            Useful for sensitive logs or to reduce noise.
                          type: boolean
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      required:
                      - entrypoint
                      type: object
                    description:
                      description: Description contains a description of the operation.
                      type: string
                    events:
                      description: Events determines the events collector to execute.
                      properties:
                        name:
                          description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                          type: string
                        namespace:
                          description: 'Namespace of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/'
                          type: string
                        selector:
                          description: Selector defines labels selector.
                          type: string
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    podLogs:
                      description: PodLogs determines the pod logs collector to execute.
                      properties:
                        container:
                          description: Container in pod to get logs from else --all-containers
                            is used.
                          type: string
                        name:
                          description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                          type: string
                        namespace:
                          description: 'Namespace of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/'
                          type: string
                        selector:
                          description: Selector defines labels selector.
                          type: string
                        tail:
                          description: Tail is the number of last lines to collect
                            from pods. If omitted or zero, then the default is 10
                            if you use a selector, or -1 (all) if you use a pod name.
                            This matches default behavior of `kubectl logs`.
                          type: integer
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    script:
                      description: Script defines a script to run.
                      properties:
                        check:
                          description: Check is an assertion tree to validate the
                            operation outcome.
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        content:
                          description: Content defines a shell script (run with "sh
                            -c ...").
                          type: string
                        skipLogOutput:
                          description: SkipLogOutput removes the output from the command.
                            Useful for sensitive logs or to reduce noise.
                          type: boolean
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    sleep:
                      description: Sleep defines zzzz.
                      properties:
                        duration:
                          description: Duration is the delay used for sleeping.
                          type: string
                      required:
                      - duration
                      type: object
                  type: object
                type: array
              skipDelete:
                description: SkipDelete determines whether the resources created by
                  the step should be deleted after the test step is executed.
                type: boolean
              timeouts:
                description: Timeouts for the test step. Overrides the global timeouts
                  set in the Configuration and the timeouts eventually set in the
                  Test.
                properties:
                  apply:
                    description: Apply defines the timeout for the apply operation
                    type: string
                  assert:
                    description: Assert defines the timeout for the assert operation
                    type: string
                  cleanup:
                    description: Cleanup defines the timeout for the cleanup operation
                    type: string
                  delete:
                    description: Delete defines the timeout for the delete operation
                    type: string
                  error:
                    description: Error defines the timeout for the error operation
                    type: string
                  exec:
                    description: Exec defines the timeout for exec operations
                    type: string
                type: object
              try:
                description: Try defines what the step will try to execute.
                items:
                  description: Operation defines a single operation, only one action
                    is permitted for a given operation.
                  properties:
                    apply:
                      description: Apply represents resources that should be applied
                        for this test step. This can include things like configuration
                        settings or any other resources that need to be available
                        during the test.
                      properties:
                        dryRun:
                          description: DryRun determines whether the file should be
                            applied in dry run mode.
                          type: boolean
                        expect:
                          description: Expect defines a list of matched checks to
                            validate the operation outcome.
                          items:
                            description: Expectation represents a check to be applied
                              on the result of an operation with a match filter to
                              determine if the verification should be considered.
                            properties:
                              check:
                                description: Match defines the matching statement.
                                type: object
                                x-kubernetes-preserve-unknown-fields: true
                              match:
                                description: Match defines the matching statement.
                                type: object
                                x-kubernetes-preserve-unknown-fields: true
                            required:
                            - check
                            type: object
                          type: array
                        file:
                          description: File is the path to the referenced file.
                          type: string
                        resource:
                          description: Resource provides a resource to be applied.
                          type: object
                          x-kubernetes-embedded-resource: true
                          x-kubernetes-preserve-unknown-fields: true
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    assert:
                      description: Assert represents an assertion to be made. It checks
                        whether the conditions specified in the assertion hold true.
                      properties:
                        file:
                          description: File is the path to the referenced file.
                          type: string
                        resource:
                          description: Resource provides a resource to be applied.
                          type: object
                          x-kubernetes-embedded-resource: true
                          x-kubernetes-preserve-unknown-fields: true
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    command:
                      description: Command defines a command to run.
                      properties:
                        args:
                          description: Args is the command arguments.
                          items:
                            type: string
                          type: array
                        check:
                          description: Check is an assertion tree to validate the
                            operation outcome.
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        entrypoint:
                          description: Entrypoint is the command entry point to run.
                          type: string
                        skipLogOutput:
                          description: SkipLogOutput removes the output from the command.
                            Useful for sensitive logs or to reduce noise.
                          type: boolean
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      required:
                      - entrypoint
                      type: object
                    continueOnError:
                      description: ContinueOnError determines whether a test should
                        continue or not in case the operation was not successful.
                        Even if the test continues executing, it will still be reported
                        as failed.
                      type: boolean
                    create:
                      description: Create represents a creation operation.
                      properties:
                        dryRun:
                          description: DryRun determines whether the file should be
                            applied in dry run mode.
                          type: boolean
                        expect:
                          description: Expect defines a list of matched checks to
                            validate the operation outcome.
                          items:
                            description: Expectation represents a check to be applied
                              on the result of an operation with a match filter to
                              determine if the verification should be considered.
                            properties:
                              check:
                                description: Match defines the matching statement.
                                type: object
                                x-kubernetes-preserve-unknown-fields: true
                              match:
                                description: Match defines the matching statement.
                                type: object
                                x-kubernetes-preserve-unknown-fields: true
                            required:
                            - check
                            type: object
                          type: array
                        file:
                          description: File is the path to the referenced file.
                          type: string
                        resource:
                          description: Resource provides a resource to be applied.
                          type: object
                          x-kubernetes-embedded-resource: true
                          x-kubernetes-preserve-unknown-fields: true
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    delete:
                      description: Delete represents a creation operation.
                      properties:
                        expect:
                          description: Expect defines a list of matched checks to
                            validate the operation outcome.
                          items:
                            description: Expectation represents a check to be applied
                              on the result of an operation with a match filter to
                              determine if the verification should be considered.
                            properties:
                              check:
                                description: Match defines the matching statement.
                                type: object
                                x-kubernetes-preserve-unknown-fields: true
                              match:
                                description: Match defines the matching statement.
                                type: object
                                x-kubernetes-preserve-unknown-fields: true
                            required:
                            - check
                            type: object
                          type: array
                        ref:
                          description: ObjectReference determines objects to be deleted.
                          properties:
                            apiVersion:
                              description: API version of the referent.
                              type: string
                            kind:
                              description: 'Kind of the referent. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
                              type: string
                            labels:
                              additionalProperties:
                                type: string
                              description: Label selector to match objects to delete
                              type: object
                            name:
                              description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names'
                              type: string
                            namespace:
                              description: 'Namespace of the referent. More info:
                                https://kubernetes.io/docs/concepts/overview/working-with-objects/namespaces/'
                              type: string
                          required:
                          - apiVersion
                          - kind
                          type: object
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      required:
                      - ref
                      type: object
                    description:
                      description: Description contains a description of the operation.
                      type: string
                    error:
                      description: Error represents the expected errors for this test
                        step. If any of these errors occur, the test will consider
                        them as expected; otherwise, they will be treated as test
                        failures.
                      properties:
                        file:
                          description: File is the path to the referenced file.
                          type: string
                        resource:
                          description: Resource provides a resource to be applied.
                          type: object
                          x-kubernetes-embedded-resource: true
                          x-kubernetes-preserve-unknown-fields: true
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    script:
                      description: Script defines a script to run.
                      properties:
                        check:
                          description: Check is an assertion tree to validate the
                            operation outcome.
                          type: object
                          x-kubernetes-preserve-unknown-fields: true
                        content:
                          description: Content defines a shell script (run with "sh
                            -c ...").
                          type: string
                        skipLogOutput:
                          description: SkipLogOutput removes the output from the command.
                            Useful for sensitive logs or to reduce noise.
                          type: boolean
                        timeout:
                          description: Timeout for the operation. Overrides the global
                            timeout set in the Configuration.
                          type: string
                      type: object
                    sleep:
                      description: Sleep defines zzzz.
                      properties:
                        duration:
                          description: Duration is the delay used for sleeping.
                          type: string
                      required:
                      - duration
                      type: object
                  type: object
                type: array
            required:
            - try
            type: object
        required:
        - spec
        type: object
    served: true
    storage: true
